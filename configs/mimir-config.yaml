# Mimir Monolithic Mode Configuration
target: all,alertmanager,ruler

# Multinant configuration - set to false for simple local setups
multitenancy_enabled: false

server:
  http_listen_port: 9009
  grpc_listen_port: 9095
  log_level: info

# Common storage block to avoid repeating S3 settings
common:
  storage:
    backend: s3
    s3:
      endpoint: ${S3_ENDPOINT}
      access_key_id: ${S3_ACCESS_KEY}
      secret_access_key: ${S3_SECRET_KEY}
      bucket_name: mimir
      insecure: true
      s3forcepathstyle: true

# Ingester handles incoming samples and writes them to the Write-Ahead Log (WAL)
ingester:
  lifecycler:
    ring:
      kvstore:
        store: inmemory
      replication_factor: 1

# Blocks storage defines how long-term data is handled
blocks_storage:
  backend: s3
  tsdb:
    dir: /data/tsdb
    ship_interval: 1m
    block_ranges_retain_period: 1h
  bucket_store:
    sync_interval: 5m

# Compactor deduplicates and optimizes blocks in S3
compactor:
  data_dir: /data/compactor
  compaction_interval: 30m
  # Retention Policies
  retention_enabled: true
  retention_resolution_raw: 30d
  retention_resolution_5m: 60d
  retention_resolution_1h: 90d
  cleanup_interval: 15m

# Ruler evaluates alerting and recording rules
ruler:
  enable_api: true
  rule_path: /data/ruler-workdir
  alertmanager_url: http://localhost:9009/alertmanager
  storage:
    backend: local
    local:
      directory: /etc/mimir/rules

# Alertmanager handles notification routing
alertmanager:
  data_dir: /data/alertmanager
  fallback_config_file: /etc/mimir/alertmanager.yaml
  external_url: http://localhost:9009/alertmanager

# Query Frontend scales the query performance
query_frontend:
  align_queries_with_step: true
  log_queries_longer_than: 5s

# Limits config prevents a single app from crashing the service
limits:
  ingestion_rate: 10000
  max_label_names_per_series: 30
  max_global_series_per_user: 100000